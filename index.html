<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REACT è‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #1976d2;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #64b5f6;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 5px;
        }
        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab.active {
            color: #64b5f6;
            border-bottom: 3px solid #64b5f6;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .domain-section {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }
        .domain-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .domain-title {
            font-size: 1.3em;
            color: #333;
            font-weight: bold;
        }
        .domain-subtitle {
            font-size: 0.9em;
            color: #666;
            margin-left: 10px;
        }
        .score-display {
            font-size: 1.5em;
            color: #64b5f6;
            font-weight: bold;
        }
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .criteria-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .criteria-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .criteria-card.selected {
            border-color: #64b5f6;
            background: #e3f2fd;
        }
        .criteria-score {
            display: inline-block;
            background: #64b5f6;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .criteria-card.selected .criteria-score {
            background: #1976d2;
        }
        .criteria-text {
            font-size: 0.9em;
            color: #333;
            line-height: 1.5;
        }
        .total-score-section {
            background: linear-gradient(135deg, #90caf9 0%, #81c784 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
        }
        .total-score-label {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .total-score-value {
            font-size: 3em;
            font-weight: bold;
        }
        .chart-container {
            max-width: 600px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        .comparison-card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }
        .comparison-card h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }
        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 5px;
        }
        .score-change {
            font-weight: bold;
        }
        .score-change.positive {
            color: #27ae60;
        }
        .score-change.negative {
            color: #e74c3c;
        }
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-primary {
            background: #64b5f6;
            color: white;
        }
        .btn-primary:hover {
            background: #42a5f5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(100, 181, 246, 0.4);
        }
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        .btn-success {
            background: #27ae60;
            color: white;
        }
        .btn-success:hover {
            background: #229954;
        }

        /* ã‚¹ãƒãƒ›å¯¾å¿œï¼ˆ768pxä»¥ä¸‹ï¼‰ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                border-radius: 15px;
            }
            h1 {
                font-size: 1.5em;
            }
            .subtitle {
                font-size: 0.85em;
            }
            .info-box {
                padding: 12px;
                font-size: 0.9em;
            }
            .tab-container {
                gap: 5px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            .tab {
                padding: 10px 15px;
                font-size: 0.85em;
                white-space: nowrap;
            }
            .domain-section {
                padding: 15px;
            }
            .domain-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .domain-title {
                font-size: 1.1em;
            }
            .domain-subtitle {
                margin-left: 0;
                font-size: 0.85em;
                display: block;
            }
            .score-display {
                font-size: 1.2em;
            }
            .criteria-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .criteria-card {
                padding: 12px;
            }
            .criteria-text {
                font-size: 0.85em;
            }
            .total-score-section {
                padding: 20px;
            }
            .total-score-label {
                font-size: 1em;
            }
            .total-score-value {
                font-size: 2.5em;
            }
            .chart-container {
                padding: 15px;
            }
            .comparison-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .comparison-card {
                padding: 15px;
            }
            .score-item {
                font-size: 0.9em;
                padding: 8px;
            }
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
            .btn {
                width: 100%;
                padding: 15px 20px;
            }
        }

        /* ã•ã‚‰ã«å°ã•ã„ç”»é¢ï¼ˆ480pxä»¥ä¸‹ï¼‰ */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.3em;
            }
            .subtitle {
                font-size: 0.8em;
            }
            .tab {
                padding: 8px 12px;
                font-size: 0.8em;
            }
            .domain-title {
                font-size: 1em;
            }
            .total-score-value {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>REACT è‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ„ãƒ¼ãƒ«</h1>
        <p class="subtitle">Rapid Evaluation Assessment of Clinical Reasoning Tool</p>

        <div class="info-box">
            <h3>ğŸ“‹ è©•ä¾¡æ–¹æ³•</h3>
            <p>å„ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã¤ã„ã¦ã€ç¾åœ¨ã®ã‚ãªãŸã®è‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«ã«æœ€ã‚‚è¿‘ã„é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
            <p>ã‚¹ã‚³ã‚¢ã¯1-3ç‚¹ã®3æ®µéšã§ã€åˆè¨ˆã‚¹ã‚³ã‚¢ã¯5ç‚¹ï¼ˆæœ€å°ï¼‰ã€œ15ç‚¹ï¼ˆæœ€å¤§ï¼‰ã¨ãªã‚Šã¾ã™ã€‚</p>
        </div>

        <div class="tab-container">
            <button class="tab active" onclick="switchTab('before')">Beforeè©•ä¾¡ï¼ˆåˆå›ï¼‰</button>
            <button class="tab" onclick="switchTab('after')">Afterè©•ä¾¡ï¼ˆ3ãƒ¶æœˆå¾Œï¼‰</button>
            <button class="tab" onclick="switchTab('comparison')">æ¯”è¼ƒçµæœ</button>
        </div>

        <!-- Beforeè©•ä¾¡ã‚¿ãƒ– -->
        <div id="before-tab" class="tab-content active">
            <h2 style="color: #1976d2; margin-bottom: 20px;">Beforeè©•ä¾¡ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ é–‹å§‹æ™‚ï¼‰</h2>
            <div id="before-assessment"></div>
            <div class="total-score-section">
                <div class="total-score-label">åˆè¨ˆã‚¹ã‚³ã‚¢</div>
                <div class="total-score-value" id="before-total">0 / 15</div>
            </div>
            <div class="chart-container">
                <canvas id="before-chart"></canvas>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveBeforeScore()">Beforeè©•ä¾¡ã‚’ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="exportBeforeCSV()">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>

        <!-- Afterè©•ä¾¡ã‚¿ãƒ– -->
        <div id="after-tab" class="tab-content">
            <h2 style="color: #1976d2; margin-bottom: 20px;">Afterè©•ä¾¡ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†æ™‚ï¼‰</h2>
            <div id="after-assessment"></div>
            <div class="total-score-section">
                <div class="total-score-label">åˆè¨ˆã‚¹ã‚³ã‚¢</div>
                <div class="total-score-value" id="after-total">0 / 15</div>
            </div>
            <div class="chart-container">
                <canvas id="after-chart"></canvas>
            </div>
            <div class="button-group">
                <button class="btn btn-success" onclick="saveAfterScore()">Afterè©•ä¾¡ã‚’ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="exportAfterCSV()">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>

        <!-- æ¯”è¼ƒã‚¿ãƒ– -->
        <div id="comparison-tab" class="tab-content">
            <h2 style="color: #1976d2; margin-bottom: 20px;">Before / After æ¯”è¼ƒ</h2>
            <div class="comparison-container">
                <div class="comparison-card">
                    <h3>ã‚¹ã‚³ã‚¢æ¯”è¼ƒ</h3>
                    <div id="score-comparison"></div>
                </div>
                <div class="comparison-card">
                    <h3>æˆé•·ã‚µãƒãƒªãƒ¼</h3>
                    <div id="growth-summary"></div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="comparison-chart"></canvas>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="exportComparisonReport()">æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›</button>
            </div>
        </div>
    </div>

    <script>
        const domains = [
            {
                id: 'collecting',
                title: 'Collectingï¼ˆåé›†ï¼‰',
                subtitle: 'ãƒ‡ãƒ¼ã‚¿åé›† - ä»®èª¬å¿—å‘å‹ã®æƒ…å ±åé›†',
                criteria: [
                    { score: 1, text: 'ä»®èª¬å¿—å‘å‹ã®æƒ…å ±åé›†ãŒã§ãã¦ã„ãªã„ã€‚ç„¡é–¢ä¿‚ãªæƒ…å ±ã‚’å«ã‚€ã€‚æ–‡è„ˆçš„ãªæ‰‹ãŒã‹ã‚Šã‚’èªè­˜ã—ã¦ã„ãªã„ã€‚' },
                    { score: 2, text: 'ä»®èª¬ã«é–¢é€£ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã§ãã‚‹ãŒã€ä¸€éƒ¨ç„¡é–¢ä¿‚ãªæƒ…å ±ã‚‚å«ã‚€ã€‚æ–‡è„ˆçš„ãªæ‰‹ãŒã‹ã‚Šã®èªè­˜ãŒé™å®šçš„ã€‚' },
                    { score: 3, text: 'ä»®èª¬å¿—å‘å‹ã®ãƒ‡ãƒ¼ã‚¿åé›†ãŒçš„ç¢ºã«ã§ãã‚‹ã€‚æ–‡è„ˆçš„ãªæ‰‹ãŒã‹ã‚Šã‚’èªè­˜ã—ã€ç·Šæ€¥æ€§ã‚’åˆ¤æ–­ã§ãã‚‹ã€‚' }
                ]
            },
            {
                id: 'interpreting',
                title: 'Interpretingï¼ˆè§£é‡ˆï¼‰',
                subtitle: 'è¨ºæ–­æ¨è«– - é‘‘åˆ¥è¨ºæ–­ã®ç”Ÿæˆ',
                criteria: [
                    { score: 1, text: 'é‘‘åˆ¥è¨ºæ–­ãŒä¸é©åˆ‡ã¾ãŸã¯æ¬ å¦‚ã—ã¦ã„ã‚‹ã€‚ç·Šæ€¥çŠ¶æ³ã§ä¸é©åˆ‡ãªè¨ºæ–­ã‚’ã™ã‚‹ã€‚' },
                    { score: 2, text: 'é‘‘åˆ¥è¨ºæ–­ã«ä¸»è¦ãªè¨ºæ–­ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŒã€é‡è¦ãªè¨ºæ–­ã‚’è¦‹é€ƒã™ã“ã¨ã‚‚ã‚ã‚‹ã€‚å„ªå…ˆé †ä½ä»˜ã‘ãŒä¸é©åˆ‡ã€‚' },
                    { score: 3, text: 'é‘‘åˆ¥è¨ºæ–­ãŒæ­£ç¢ºã§ã€å¯èƒ½æ€§ã®é«˜ã„é †ã«ãƒ©ãƒ³ã‚¯ä»˜ã‘ã§ãã‚‹ã€‚ç·Šæ€¥çŠ¶æ³ã§ã®è¨ºæ–­ãŒé©åˆ‡ã€‚' }
                ]
            },
            {
                id: 'managing',
                title: 'Managingï¼ˆç®¡ç†ï¼‰',
                subtitle: 'ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ¨è«– - è©•ä¾¡ã¨æ²»ç™‚è¨ˆç”»',
                criteria: [
                    { score: 1, text: 'è©•ä¾¡ã¨æ²»ç™‚ãŒä¸é©åˆ‡ãªè¨ºæ–­ã«å‘ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã€‚åˆæœŸä»‹å…¥ã¸ã®åå¿œã‚’è©•ä¾¡ã—ã¦ã„ãªã„ã€‚' },
                    { score: 2, text: 'ä¸»è¦è¨ºæ–­ã«å¯¾ã™ã‚‹è©•ä¾¡ãƒ»æ²»ç™‚ã¯ã‚ã‚‹ãŒã€ç·Šæ€¥æ€§ã®ä½ã„è¨ºæ–­ã«ç„¦ç‚¹ã‚’å½“ã¦ãŒã¡ã€‚åˆæœŸä»‹å…¥ã¸ã®åå¿œè©•ä¾¡ãŒé™å®šçš„ã€‚' },
                    { score: 3, text: 'æœ€ã‚‚å¯èƒ½æ€§ã®é«˜ã„ç·Šæ€¥è¨ºæ–­ã«å¯¾ã—ã¦åŠ¹ç‡çš„ãªè©•ä¾¡ãƒ»æ²»ç™‚ã‚’å®Ÿæ–½ã€‚åˆæœŸä»‹å…¥ã¸ã®åå¿œã‚’è©•ä¾¡ã§ãã‚‹ã€‚' }
                ]
            },
            {
                id: 'communicating',
                title: 'Communicatingï¼ˆã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰',
                subtitle: 'æ‚£è€…ä¸­å¿ƒã®ã‚±ã‚¢ - åŒ»ç™‚ãƒãƒ¼ãƒ ã¨ã®é€£æº',
                criteria: [
                    { score: 1, text: 'åŒ»ç™‚ãƒãƒ¼ãƒ ã¨ã®é€£æºãŒã§ãã¦ã„ãªã„ã€‚æ²»ç™‚è¨ˆç”»ã®èª¬æ˜ãŒä¸ååˆ†ã€‚æ‚£è€…ã®ç›®æ¨™ã‚’è€ƒæ…®ã—ã¦ã„ãªã„ã€‚' },
                    { score: 2, text: 'åŒ»ç™‚ãƒãƒ¼ãƒ ã¨ã®é€£æºãŒé™å®šçš„ã€‚æ²»ç™‚è¨ˆç”»ã®èª¬æ˜ãŒä¸å®Œå…¨ã€‚æ‚£è€…ã®ç›®æ¨™ã®ç†è§£ãƒ»ç¢ºèªãŒä¸ååˆ†ã€‚' },
                    { score: 3, text: 'å½¹å‰²ã«å¿œã˜ã¦åŒ»ç™‚ãƒãƒ¼ãƒ ã¨åŠ¹æœçš„ã«é€£æºã€‚æ²»ç™‚è¨ˆç”»ã‚’æ˜ç¢ºã«èª¬æ˜ã€‚æ‚£è€…ãƒ»å®¶æ—ã®ç›®æ¨™ã‚’ç†è§£ãƒ»ç¢ºèªã§ãã‚‹ã€‚' }
                ]
            },
            {
                id: 'reflecting',
                title: 'Reflectingï¼ˆçœå¯Ÿï¼‰',
                subtitle: 'ãƒ¡ã‚¿èªçŸ¥ - è‡¨åºŠå ´é¢ã®æŒ¯ã‚Šè¿”ã‚Š',
                criteria: [
                    { score: 1, text: 'æ„æ€æ±ºå®šã«å½±éŸ¿ã—ãŸèªçŸ¥çš„ãƒ»æ„Ÿæƒ…çš„è¦å› ã«æ°—ã¥ã„ã¦ã„ãªã„ã€‚ãã‚Œã‚‰ã®è¦å› ã‚’è»½æ¸›ã§ããªã„ã€‚' },
                    { score: 2, text: 'èªçŸ¥çš„ãƒ»æ„Ÿæƒ…çš„è¦å› ã¸ã®æ°—ã¥ããŒé™å®šçš„ã€‚ãã‚Œã‚‰ã®è¦å› ã‚’è»½æ¸›ã™ã‚‹å–ã‚Šçµ„ã¿ãŒé™å®šçš„ã€‚' },
                    { score: 3, text: 'èªçŸ¥çš„ãƒ»æ„Ÿæƒ…çš„è¦å› ã‚’ååˆ†ã«èªè­˜ã—ã¦ã„ã‚‹ã€‚ãã‚Œã‚‰ã®è¦å› ã‚’åŠ¹æœçš„ã«è»½æ¸›ã§ãã‚‹ã€‚' }
                ]
            }
        ];

        let beforeScores = {};
        let afterScores = {};
        let beforeChart = null;
        let afterChart = null;
        let comparisonChart = null;

        // åˆæœŸåŒ–
        function init() {
            createAssessment('before');
            createAssessment('after');
            loadSavedScores();
            updateAllCharts();
        }

        // è©•ä¾¡ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ
        function createAssessment(type) {
            const container = document.getElementById(`${type}-assessment`);
            container.innerHTML = '';

            domains.forEach(domain => {
                const section = document.createElement('div');
                section.className = 'domain-section';
                section.innerHTML = `
                    <div class="domain-header">
                        <div>
                            <span class="domain-title">${domain.title}</span>
                            <span class="domain-subtitle">${domain.subtitle}</span>
                        </div>
                        <div class="score-display" id="${type}-${domain.id}-score">æœªé¸æŠ</div>
                    </div>
                    <div class="criteria-grid" id="${type}-${domain.id}-grid"></div>
                `;
                container.appendChild(section);

                const grid = document.getElementById(`${type}-${domain.id}-grid`);
                domain.criteria.forEach(criteria => {
                    const card = document.createElement('div');
                    card.className = 'criteria-card';
                    card.innerHTML = `
                        <div class="criteria-score">${criteria.score}ç‚¹</div>
                        <div class="criteria-text">${criteria.text}</div>
                    `;
                    card.onclick = () => selectCriteria(type, domain.id, criteria.score);
                    grid.appendChild(card);
                });
            });
        }

        // åŸºæº–ã®é¸æŠ
        function selectCriteria(type, domainId, score) {
            const scores = type === 'before' ? beforeScores : afterScores;
            scores[domainId] = score;

            // é¸æŠçŠ¶æ…‹ã®æ›´æ–°
            const grid = document.getElementById(`${type}-${domainId}-grid`);
            const cards = grid.querySelectorAll('.criteria-card');
            cards.forEach((card, index) => {
                card.classList.toggle('selected', index + 1 === score);
            });

            // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã®æ›´æ–°
            document.getElementById(`${type}-${domainId}-score`).textContent = `${score}ç‚¹`;

            // åˆè¨ˆã‚¹ã‚³ã‚¢ã®æ›´æ–°
            updateTotalScore(type);
            updateChart(type);
        }

        // åˆè¨ˆã‚¹ã‚³ã‚¢ã®æ›´æ–°
        function updateTotalScore(type) {
            const scores = type === 'before' ? beforeScores : afterScores;
            const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
            document.getElementById(`${type}-total`).textContent = `${total} / 15`;
        }

        // ãƒãƒ£ãƒ¼ãƒˆã®æ›´æ–°
        function updateChart(type) {
            const scores = type === 'before' ? beforeScores : afterScores;
            const data = domains.map(d => scores[d.id] || 0);
            const labels = domains.map(d => d.title.split('ï¼ˆ')[0]);

            const canvas = document.getElementById(`${type}-chart`);
            const ctx = canvas.getContext('2d');

            if (type === 'before' && beforeChart) {
                beforeChart.destroy();
            } else if (type === 'after' && afterChart) {
                afterChart.destroy();
            }

            const chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: type === 'before' ? 'Beforeè©•ä¾¡' : 'Afterè©•ä¾¡',
                        data: data,
                        backgroundColor: type === 'before' ? 'rgba(100, 181, 246, 0.2)' : 'rgba(129, 199, 132, 0.2)',
                        borderColor: type === 'before' ? 'rgba(100, 181, 246, 1)' : 'rgba(129, 199, 132, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: type === 'before' ? 'rgba(100, 181, 246, 1)' : 'rgba(129, 199, 132, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: type === 'before' ? 'rgba(100, 181, 246, 1)' : 'rgba(129, 199, 132, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            min: 0,
                            max: 3,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });

            if (type === 'before') {
                beforeChart = chart;
            } else {
                afterChart = chart;
            }
        }

        // æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆã®æ›´æ–°
        function updateComparisonChart() {
            const beforeData = domains.map(d => beforeScores[d.id] || 0);
            const afterData = domains.map(d => afterScores[d.id] || 0);
            const labels = domains.map(d => d.title.split('ï¼ˆ')[0]);

            const canvas = document.getElementById('comparison-chart');
            const ctx = canvas.getContext('2d');

            if (comparisonChart) {
                comparisonChart.destroy();
            }

            comparisonChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Beforeè©•ä¾¡',
                            data: beforeData,
                            backgroundColor: 'rgba(100, 181, 246, 0.2)',
                            borderColor: 'rgba(100, 181, 246, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(100, 181, 246, 1)'
                        },
                        {
                            label: 'Afterè©•ä¾¡',
                            data: afterData,
                            backgroundColor: 'rgba(129, 199, 132, 0.2)',
                            borderColor: 'rgba(129, 199, 132, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(129, 199, 132, 1)'
                        }
                    ]
                },
                options: {
                    scales: {
                        r: {
                            min: 0,
                            max: 3,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // æ¯”è¼ƒçµæœã®æ›´æ–°
        function updateComparison() {
            const comparisonDiv = document.getElementById('score-comparison');
            const summaryDiv = document.getElementById('growth-summary');

            let comparisonHTML = '';
            let improvements = 0;
            let totalChange = 0;

            domains.forEach(domain => {
                const before = beforeScores[domain.id] || 0;
                const after = afterScores[domain.id] || 0;
                const change = after - before;
                totalChange += change;

                if (change > 0) improvements++;

                const changeClass = change > 0 ? 'positive' : (change < 0 ? 'negative' : '');
                const changeText = change > 0 ? `+${change}` : change;

                comparisonHTML += `
                    <div class="score-item">
                        <span>${domain.title.split('ï¼ˆ')[0]}</span>
                        <span>${before}ç‚¹ â†’ ${after}ç‚¹ <span class="score-change ${changeClass}">(${changeText})</span></span>
                    </div>
                `;
            });

            comparisonDiv.innerHTML = comparisonHTML;

            const beforeTotal = Object.values(beforeScores).reduce((sum, s) => sum + s, 0);
            const afterTotal = Object.values(afterScores).reduce((sum, s) => sum + s, 0);
            const totalChangeValue = afterTotal - beforeTotal;
            const totalChangeClass = totalChangeValue > 0 ? 'positive' : (totalChangeValue < 0 ? 'negative' : '');

            summaryDiv.innerHTML = `
                <div class="score-item">
                    <span>åˆè¨ˆã‚¹ã‚³ã‚¢</span>
                    <span>${beforeTotal}ç‚¹ â†’ ${afterTotal}ç‚¹ <span class="score-change ${totalChangeClass}">(${totalChangeValue > 0 ? '+' : ''}${totalChangeValue})</span></span>
                </div>
                <div class="score-item">
                    <span>æ”¹å–„ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³æ•°</span>
                    <span>${improvements} / 5</span>
                </div>
                <div class="score-item">
                    <span>å¹³å‡ã‚¹ã‚³ã‚¢</span>
                    <span>${(beforeTotal / 5).toFixed(1)}ç‚¹ â†’ ${(afterTotal / 5).toFixed(1)}ç‚¹</span>
                </div>
            `;

            updateComparisonChart();
        }

        // ã™ã¹ã¦ã®ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°
        function updateAllCharts() {
            updateChart('before');
            updateChart('after');
            updateComparison();
        }

        // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');

            if (tabName === 'comparison') {
                updateComparison();
            }
        }

        // Beforeè©•ä¾¡ã‚’ä¿å­˜
        function saveBeforeScore() {
            if (Object.keys(beforeScores).length < 5) {
                alert('ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            localStorage.setItem('reactBeforeScores', JSON.stringify(beforeScores));
            alert('Beforeè©•ä¾¡ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        // Afterè©•ä¾¡ã‚’ä¿å­˜
        function saveAfterScore() {
            if (Object.keys(afterScores).length < 5) {
                alert('ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            localStorage.setItem('reactAfterScores', JSON.stringify(afterScores));
            alert('Afterè©•ä¾¡ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        // ä¿å­˜ã•ã‚ŒãŸè©•ä¾¡ã‚’èª­ã¿è¾¼ã¿
        function loadSavedScores() {
            const savedBefore = localStorage.getItem('reactBeforeScores');
            const savedAfter = localStorage.getItem('reactAfterScores');

            if (savedBefore) {
                beforeScores = JSON.parse(savedBefore);
                Object.entries(beforeScores).forEach(([domainId, score]) => {
                    selectCriteria('before', domainId, score);
                });
            }

            if (savedAfter) {
                afterScores = JSON.parse(savedAfter);
                Object.entries(afterScores).forEach(([domainId, score]) => {
                    selectCriteria('after', domainId, score);
                });
            }
        }

        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆBeforeï¼‰
        function exportBeforeCSV() {
            if (Object.keys(beforeScores).length < 5) {
                alert('ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            exportCSV(beforeScores, 'REACT_Beforeè©•ä¾¡');
        }

        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆAfterï¼‰
        function exportAfterCSV() {
            if (Object.keys(afterScores).length < 5) {
                alert('ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            exportCSV(afterScores, 'REACT_Afterè©•ä¾¡');
        }

        // CSVå‡ºåŠ›
        function exportCSV(scores, filename) {
            const total = Object.values(scores).reduce((sum, s) => sum + s, 0);
            let csv = 'ãƒ‰ãƒ¡ã‚¤ãƒ³,ã‚¹ã‚³ã‚¢\n';
            domains.forEach(domain => {
                csv += `${domain.title},${scores[domain.id] || 0}\n`;
            });
            csv += `åˆè¨ˆ,${total}\n`;

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
        function exportComparisonReport() {
            if (Object.keys(beforeScores).length < 5 || Object.keys(afterScores).length < 5) {
                alert('Beforeã¨Afterä¸¡æ–¹ã®è©•ä¾¡ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const beforeTotal = Object.values(beforeScores).reduce((sum, s) => sum + s, 0);
            const afterTotal = Object.values(afterScores).reduce((sum, s) => sum + s, 0);
            const totalChange = afterTotal - beforeTotal;

            let markdown = `# REACT è‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«è©•ä¾¡ æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆ\n\n`;
            markdown += `**è©•ä¾¡æ—¥**: ${new Date().toLocaleDateString('ja-JP')}\n\n`;
            markdown += `---\n\n`;
            markdown += `## ğŸ“Š ç·åˆã‚¹ã‚³ã‚¢\n\n`;
            markdown += `- **Before**: ${beforeTotal} / 15ç‚¹\n`;
            markdown += `- **After**: ${afterTotal} / 15ç‚¹\n`;
            markdown += `- **å¤‰åŒ–**: ${totalChange > 0 ? '+' : ''}${totalChange}ç‚¹\n\n`;
            markdown += `---\n\n`;
            markdown += `## ğŸ“ˆ ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ã‚¹ã‚³ã‚¢\n\n`;
            markdown += `| ãƒ‰ãƒ¡ã‚¤ãƒ³ | Before | After | å¤‰åŒ– |\n`;
            markdown += `|---------|--------|-------|------|\n`;

            domains.forEach(domain => {
                const before = beforeScores[domain.id] || 0;
                const after = afterScores[domain.id] || 0;
                const change = after - before;
                markdown += `| ${domain.title} | ${before}ç‚¹ | ${after}ç‚¹ | ${change > 0 ? '+' : ''}${change}ç‚¹ |\n`;
            });

            markdown += `\n---\n\n`;
            markdown += `## ğŸ’¡ æˆé•·ã‚µãƒãƒªãƒ¼\n\n`;

            const improvements = domains.filter(d => (afterScores[d.id] || 0) > (beforeScores[d.id] || 0));
            if (improvements.length > 0) {
                markdown += `### æ”¹å–„ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ${improvements.length} / 5ï¼‰\n\n`;
                improvements.forEach(domain => {
                    const change = afterScores[domain.id] - beforeScores[domain.id];
                    markdown += `- **${domain.title}**: +${change}ç‚¹ã®å‘ä¸Š\n`;
                });
                markdown += `\n`;
            }

            const maintained = domains.filter(d => (afterScores[d.id] || 0) === (beforeScores[d.id] || 0));
            if (maintained.length > 0) {
                markdown += `### ç¶­æŒã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ${maintained.length} / 5ï¼‰\n\n`;
                maintained.forEach(domain => {
                    markdown += `- **${domain.title}**: ${beforeScores[domain.id]}ç‚¹ã‚’ç¶­æŒ\n`;
                });
                markdown += `\n`;
            }

            markdown += `---\n\n`;
            markdown += `**ğŸ¤– Generated by REACTè‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ„ãƒ¼ãƒ«**\n`;

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `REACTæ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆ_${new Date().toISOString().split('T')[0]}.md`;
            link.click();

            alert('æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        init();
    </script>
</body>
</html>
