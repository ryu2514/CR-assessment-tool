<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REACT è‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #1976d2;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #64b5f6;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 5px;
        }
        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab.active {
            color: #64b5f6;
            border-bottom: 3px solid #64b5f6;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .domain-section {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }
        .domain-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .domain-title {
            font-size: 1.3em;
            color: #333;
            font-weight: bold;
        }
        .domain-subtitle {
            font-size: 0.9em;
            color: #666;
            margin-left: 10px;
        }
        .score-display {
            font-size: 1.5em;
            color: #64b5f6;
            font-weight: bold;
        }
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .criteria-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .criteria-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .criteria-card.selected {
            border-color: #64b5f6;
            background: #e3f2fd;
        }
        .criteria-score {
            display: inline-block;
            background: #64b5f6;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .criteria-card.selected .criteria-score {
            background: #1976d2;
        }
        .criteria-text {
            font-size: 0.9em;
            color: #333;
            line-height: 1.5;
        }
        .total-score-section {
            background: linear-gradient(135deg, #90caf9 0%, #81c784 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
        }
        .total-score-label {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .total-score-value {
            font-size: 3em;
            font-weight: bold;
        }
        .score-level-badge {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
        }
        .score-level-badge.needs-improvement {
            background: #ff9800;
            color: white;
        }
        .score-level-badge.goal-achieved {
            background: #4caf50;
            color: white;
        }
        .score-feedback {
            margin-top: 15px;
            font-size: 0.95em;
            line-height: 1.6;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        .chart-container {
            max-width: 600px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        .comparison-card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }
        .comparison-card h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }
        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 5px;
        }
        .score-change {
            font-weight: bold;
        }
        .score-change.positive {
            color: #27ae60;
        }
        .score-change.negative {
            color: #e74c3c;
        }
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-primary {
            background: #64b5f6;
            color: white;
        }
        .btn-primary:hover {
            background: #42a5f5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(100, 181, 246, 0.4);
        }
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        .btn-success {
            background: #27ae60;
            color: white;
        }
        .btn-success:hover {
            background: #229954;
        }

        /* æ”¹å–„ã‚¿ã‚¹ã‚¯è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .improvement-section {
            background: #fff9e6;
            border: 2px solid #ffa726;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        .improvement-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: #f57c00;
        }
        .improvement-header h3 {
            margin: 0;
            font-size: 1.4em;
        }
        .improvement-intro {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffa726;
        }
        .domain-improvement {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }
        .domain-improvement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        .domain-improvement-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        .current-score-badge {
            background: #ff9800;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .task-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            margin-bottom: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .task-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }
        .task-checkbox {
            width: 20px;
            height: 20px;
            min-width: 20px;
            border: 2px solid #64b5f6;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 2px;
        }
        .task-checkbox:hover {
            background: #e3f2fd;
        }
        .task-content {
            flex: 1;
        }
        .task-text {
            color: #333;
            line-height: 1.6;
            margin-bottom: 5px;
        }
        .task-priority {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            margin-top: 5px;
        }
        .task-priority.high {
            background: #ffebee;
            color: #c62828;
        }
        .task-priority.medium {
            background: #fff3e0;
            color: #ef6c00;
        }
        .no-improvements {
            text-align: center;
            padding: 30px;
            color: #27ae60;
            font-size: 1.1em;
        }
        .no-improvements .emoji {
            font-size: 3em;
            margin-bottom: 15px;
        }

        /* ã‚¹ãƒãƒ›å¯¾å¿œï¼ˆ768pxä»¥ä¸‹ï¼‰ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                border-radius: 15px;
            }
            h1 {
                font-size: 1.5em;
            }
            .subtitle {
                font-size: 0.85em;
            }
            .info-box {
                padding: 12px;
                font-size: 0.9em;
            }
            .tab-container {
                gap: 5px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            .tab {
                padding: 10px 15px;
                font-size: 0.85em;
                white-space: nowrap;
            }
            .domain-section {
                padding: 15px;
            }
            .domain-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .domain-title {
                font-size: 1.1em;
            }
            .domain-subtitle {
                margin-left: 0;
                font-size: 0.85em;
                display: block;
            }
            .score-display {
                font-size: 1.2em;
            }
            .criteria-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .criteria-card {
                padding: 12px;
            }
            .criteria-text {
                font-size: 0.85em;
            }
            .total-score-section {
                padding: 20px;
            }
            .total-score-label {
                font-size: 1em;
            }
            .total-score-value {
                font-size: 2.5em;
            }
            .chart-container {
                padding: 15px;
            }
            .comparison-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .comparison-card {
                padding: 15px;
            }
            .score-item {
                font-size: 0.9em;
                padding: 8px;
            }
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
            .btn {
                width: 100%;
                padding: 15px 20px;
            }
            .improvement-section {
                padding: 15px;
            }
            .improvement-header h3 {
                font-size: 1.1em;
            }
            .domain-improvement {
                padding: 15px;
            }
            .domain-improvement-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .domain-improvement-title {
                font-size: 1em;
            }
            .task-item {
                padding: 10px;
            }
            .task-text {
                font-size: 0.9em;
            }
        }

        /* ã•ã‚‰ã«å°ã•ã„ç”»é¢ï¼ˆ480pxä»¥ä¸‹ï¼‰ */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.3em;
            }
            .subtitle {
                font-size: 0.8em;
            }
            .tab {
                padding: 8px 12px;
                font-size: 0.8em;
            }
            .domain-title {
                font-size: 1em;
            }
            .total-score-value {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>REACT è‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ„ãƒ¼ãƒ«</h1>
        <p class="subtitle">Rapid Evaluation Assessment of Clinical Reasoning Tool</p>

        <div class="info-box">
            <h3>ğŸ“‹ è©•ä¾¡æ–¹æ³•</h3>
            <p>å„ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã¤ã„ã¦ã€ç¾åœ¨ã®ã‚ãªãŸã®è‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«ã«æœ€ã‚‚è¿‘ã„é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
            <p>ã‚¹ã‚³ã‚¢ã¯1-3ç‚¹ã®3æ®µéšã§ã€åˆè¨ˆã‚¹ã‚³ã‚¢ã¯5ç‚¹ï¼ˆæœ€å°ï¼‰ã€œ15ç‚¹ï¼ˆæœ€å¤§ï¼‰ã¨ãªã‚Šã¾ã™ã€‚</p>
            <p><strong>ğŸ“Š åŸºæº–å€¤ï¼š</strong>12ç‚¹ä»¥ä¸‹ã¯ã€Œè¦æ”¹å–„ãƒ¬ãƒ™ãƒ«ã€ã€<strong>13ç‚¹ä»¥ä¸ŠãŒã€Œè¬›åº§ç›®æ¨™ãƒ¬ãƒ™ãƒ«ã€</strong>ã§ã™ã€‚ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«ã‚ªãƒ¬ãƒ³ã‚¸ã®ç‚¹ç·šã§ç›®æ¨™ãƒ¬ãƒ™ãƒ«ï¼ˆå¹³å‡2.6ç‚¹/ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        </div>

        <div class="tab-container">
            <button class="tab active" onclick="switchTab('before')">Beforeè©•ä¾¡ï¼ˆåˆå›ï¼‰</button>
            <button class="tab" onclick="switchTab('after')">Afterè©•ä¾¡ï¼ˆ3ãƒ¶æœˆå¾Œï¼‰</button>
            <button class="tab" onclick="switchTab('comparison')">æ¯”è¼ƒçµæœ</button>
        </div>

        <!-- Beforeè©•ä¾¡ã‚¿ãƒ– -->
        <div id="before-tab" class="tab-content active">
            <h2 style="color: #1976d2; margin-bottom: 20px;">Beforeè©•ä¾¡ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ é–‹å§‹æ™‚ï¼‰</h2>
            <div id="before-assessment"></div>
            <div class="total-score-section">
                <div class="total-score-label">åˆè¨ˆã‚¹ã‚³ã‚¢</div>
                <div class="total-score-value" id="before-total">0 / 15</div>
                <div id="before-level-badge"></div>
                <div id="before-feedback" class="score-feedback"></div>
            </div>
            <div class="chart-container">
                <canvas id="before-chart"></canvas>
            </div>

            <!-- æ”¹å–„ã‚¿ã‚¹ã‚¯è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="before-improvement-section"></div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="saveBeforeScore()">Beforeè©•ä¾¡ã‚’ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="exportBeforeCSV()">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>

        <!-- Afterè©•ä¾¡ã‚¿ãƒ– -->
        <div id="after-tab" class="tab-content">
            <h2 style="color: #1976d2; margin-bottom: 20px;">Afterè©•ä¾¡ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†æ™‚ï¼‰</h2>
            <div id="after-assessment"></div>
            <div class="total-score-section">
                <div class="total-score-label">åˆè¨ˆã‚¹ã‚³ã‚¢</div>
                <div class="total-score-value" id="after-total">0 / 15</div>
                <div id="after-level-badge"></div>
                <div id="after-feedback" class="score-feedback"></div>
            </div>
            <div class="chart-container">
                <canvas id="after-chart"></canvas>
            </div>

            <!-- æ”¹å–„ã‚¿ã‚¹ã‚¯è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="after-improvement-section"></div>

            <div class="button-group">
                <button class="btn btn-success" onclick="saveAfterScore()">Afterè©•ä¾¡ã‚’ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="exportAfterCSV()">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>

        <!-- æ¯”è¼ƒã‚¿ãƒ– -->
        <div id="comparison-tab" class="tab-content">
            <h2 style="color: #1976d2; margin-bottom: 20px;">Before / After æ¯”è¼ƒ</h2>
            <div class="comparison-container">
                <div class="comparison-card">
                    <h3>ã‚¹ã‚³ã‚¢æ¯”è¼ƒ</h3>
                    <div id="score-comparison"></div>
                </div>
                <div class="comparison-card">
                    <h3>æˆé•·ã‚µãƒãƒªãƒ¼</h3>
                    <div id="growth-summary"></div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="comparison-chart"></canvas>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="exportComparisonReport()">æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›</button>
            </div>
        </div>
    </div>

    <script>
        const domains = [
            {
                id: 'collecting',
                title: 'Collectingï¼ˆåé›†ï¼‰',
                subtitle: 'ãƒ‡ãƒ¼ã‚¿åé›† - å¿…è¦ãªè©•ä¾¡ã‚’åŠ¹ç‡çš„ã«å®Ÿæ–½ã§ãã‚‹ã‹',
                criteria: [
                    { score: 1, text: 'ä½•ã‚’è©•ä¾¡ã™ã¹ãã‹ã‚ã‹ã‚‰ãšã€æ‰‹å½“ãŸã‚Šæ¬¡ç¬¬ã«è©•ä¾¡ã—ã¦ã„ã‚‹ã€‚æ‚£è€…ã®è¨´ãˆã‚„çŠ¶æ³ã‹ã‚‰å¿…è¦ãªè©•ä¾¡ã‚’çµã‚Œãªã„ã€‚' },
                    { score: 2, text: 'ä»®èª¬ã«é–¢é€£ã™ã‚‹è©•ä¾¡ã¯ã§ãã‚‹ãŒã€ä½™è¨ˆãªè©•ä¾¡ã‚‚å¤šã„ã€‚é‡è¦ãªè©•ä¾¡ã‚’è¦‹é€ƒã™ã“ã¨ã‚‚ã‚ã‚‹ã€‚' },
                    { score: 3, text: 'æ‚£è€…ã®è¨´ãˆã‚„çŠ¶æ³ã‹ã‚‰ä»®èª¬ã‚’ç«‹ã¦ã€å¿…è¦ãªè©•ä¾¡ã ã‘ã‚’åŠ¹ç‡çš„ã«å®Ÿæ–½ã§ãã‚‹ã€‚' }
                ],
                improvementTasks: {
                    1: [
                        { task: 'å•è¨ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã€ç³»çµ±çš„ãªæƒ…å ±åé›†ã‚’ç·´ç¿’ã™ã‚‹', priority: 'high' },
                        { task: 'SOAPã®Sï¼ˆä¸»è¦³çš„æƒ…å ±ï¼‰ã®è¨˜éŒ²ã‚’æ¯å›ä¸å¯§ã«æ›¸ãç·´ç¿’ã‚’ã™ã‚‹', priority: 'high' },
                        { task: 'Red Flagï¼ˆå±é™ºã‚µã‚¤ãƒ³ï¼‰ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã€å¿…ãšç¢ºèªã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹', priority: 'high' },
                        { task: 'å…ˆè¼©ã®å•è¨ºãƒ»è©•ä¾¡ã‚’è¦³å¯Ÿã—ã€ã©ã®ã‚ˆã†ãªé †åºã§æƒ…å ±ã‚’é›†ã‚ã¦ã„ã‚‹ã‹å­¦ã¶', priority: 'medium' }
                    ],
                    2: [
                        { task: 'è©•ä¾¡å‰ã«ã€Œä»Šæ—¥ç¢ºèªã™ã¹ã3ã¤ã®ãƒã‚¤ãƒ³ãƒˆã€ã‚’äº‹å‰ã«æ±ºã‚ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹', priority: 'high' },
                        { task: 'Red Flagã‚’è¦‹é€ƒã—ã¦ã„ãªã„ã‹ã€æ¯å›ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã™ã‚‹', priority: 'high' },
                        { task: 'ä»®èª¬æ¤œè¨¼å‹ã®è©•ä¾¡æ‰‹é †ã‚’æ„è­˜ã—ã€ç„¡é§„ãªè©•ä¾¡ã‚’æ¸›ã‚‰ã™ç·´ç¿’ã‚’ã™ã‚‹', priority: 'medium' }
                    ]
                }
            },
            {
                id: 'interpreting',
                title: 'Interpretingï¼ˆè§£é‡ˆï¼‰',
                subtitle: 'è¨ºæ–­æ¨è«– - å•é¡Œç‚¹ã‚’æ­£ç¢ºã«ç‰¹å®šã§ãã‚‹ã‹',
                criteria: [
                    { score: 1, text: 'è©•ä¾¡çµæœã‹ã‚‰å•é¡Œç‚¹ï¼ˆæ©Ÿèƒ½éšœå®³ãƒ»èƒ½åŠ›ä½ä¸‹ï¼‰ã‚’ç‰¹å®šã§ããªã„ã€ã¾ãŸã¯çš„å¤–ã‚Œãªè§£é‡ˆã‚’ã—ã¦ã—ã¾ã†ã€‚' },
                    { score: 2, text: 'ä¸»ãªå•é¡Œç‚¹ã¯è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ãŒã€é‡è¦ãªå•é¡Œã‚’è¦‹é€ƒã™ã“ã¨ã‚‚ã‚ã‚‹ã€‚å„ªå…ˆé †ä½ä»˜ã‘ãŒä¸ååˆ†ã€‚' },
                    { score: 3, text: 'è©•ä¾¡çµæœã‹ã‚‰å•é¡Œç‚¹ã‚’æ­£ç¢ºã«ç‰¹å®šã—ã€å„ªå…ˆé †ä½ã‚’ã¤ã‘ã¦æ•´ç†ã§ãã‚‹ã€‚' }
                ],
                improvementTasks: {
                    1: [
                        { task: 'ç—‡ä¾‹ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã«ç©æ¥µçš„ã«å‚åŠ ã—ã€å•é¡Œç‚¹ã®æ•´ç†æ–¹æ³•ã‚’å­¦ã¶', priority: 'high' },
                        { task: 'é‘‘åˆ¥ãƒªã‚¹ãƒˆã‚’æ¯å›ä½œæˆã™ã‚‹ç·´ç¿’ã‚’ã™ã‚‹ï¼ˆæœ€ä½3ã¤ã®é‘‘åˆ¥ã‚’è€ƒãˆã‚‹ï¼‰', priority: 'high' },
                        { task: 'å•é¡Œè¡¨ç¾ï¼ˆProblem Representationï¼‰ã®ç·´ç¿’ï¼šã€Œã€‡ã€‡ã‚’å‘ˆã™ã‚‹Ã—Ã—æ­³ã®æ‚£è€…ã€å½¢å¼ã§æ•´ç†ã™ã‚‹', priority: 'high' },
                        { task: 'è©•ä¾¡çµæœã‚’ã€Œæ©Ÿèƒ½éšœå®³ã€ã€Œæ´»å‹•åˆ¶é™ã€ã€Œå‚åŠ åˆ¶ç´„ã€ã«åˆ†é¡ã—ã¦æ•´ç†ã™ã‚‹', priority: 'medium' }
                    ],
                    2: [
                        { task: 'é‡è¦åº¦ãƒ»ç·Šæ€¥åº¦ãƒãƒˆãƒªã‚¯ã‚¹ã§å•é¡Œç‚¹ã‚’æ•´ç†ã—ã€å„ªå…ˆé †ä½ã‚’ã¤ã‘ã‚‹ç·´ç¿’ã‚’ã™ã‚‹', priority: 'high' },
                        { task: 'å…ˆè¼©ã«ã€Œä»–ã«è€ƒãˆã‚‰ã‚Œã‚‹é‘‘åˆ¥ã¯ãªã„ã‹ï¼Ÿã€ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚‚ã‚‰ã†', priority: 'medium' },
                        { task: 'ç—‡ä¾‹ç™ºè¡¨æ™‚ã«ã€å¿…ãšé‘‘åˆ¥ãƒªã‚¹ãƒˆã¨å•é¡Œè¡¨ç¾ã‚’å«ã‚ã‚‹', priority: 'medium' }
                    ]
                }
            },
            {
                id: 'managing',
                title: 'Managingï¼ˆç®¡ç†ï¼‰',
                subtitle: 'ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ¨è«– - é©åˆ‡ãªæ²»ç™‚è¨ˆç”»ã‚’ç«‹ã¦ã‚‰ã‚Œã‚‹ã‹',
                criteria: [
                    { score: 1, text: 'å•é¡Œç‚¹ã«å¯¾ã—ã¦çš„å¤–ã‚Œãªæ²»ç™‚è¨ˆç”»ã‚’ç«‹ã¦ã¦ã—ã¾ã†ã€‚æ²»ç™‚ã®åŠ¹æœã‚’ç¢ºèªã§ãã¦ã„ãªã„ã€‚' },
                    { score: 2, text: 'å¿…è¦ãªæ²»ç™‚ã¯é¸ã¹ã‚‹ãŒã€å„ªå…ˆé †ä½ä»˜ã‘ãŒä¸ååˆ†ã€‚æ²»ç™‚åŠ¹æœã®ç¢ºèªã‚‚ä¸å®Œå…¨ã€‚' },
                    { score: 3, text: 'å•é¡Œç‚¹ã«å¯¾ã—ã¦å„ªå…ˆåº¦ã®é«˜ã„æ²»ç™‚ã‚’åŠ¹ç‡çš„ã«å®Ÿæ–½ã—ã€åŠ¹æœã‚’ç¢ºèªã§ãã‚‹ã€‚' }
                ],
                improvementTasks: {
                    1: [
                        { task: 'Red Flagã‚’ç³»çµ±çš„ã«å­¦ã³ã€ã€Œãƒªãƒã§å®Œçµã—ã¦ã¯ã„ã‘ãªã„ã‚±ãƒ¼ã‚¹ã€ã®åˆ¤æ–­åŸºæº–ã‚’æ˜ç¢ºã«ã™ã‚‹', priority: 'high' },
                        { task: 'ç´¹ä»‹åŸºæº–ãƒ»æ•‘æ€¥æ¬é€åŸºæº–ã‚’ç¢ºèªã—ã€ã„ã¤åŒ»å¸«ã«ã‚³ãƒ³ã‚µãƒ«ãƒˆã™ã¹ãã‹å­¦ã¶', priority: 'high' },
                        { task: 'æ²»ç™‚å‰å¾Œã§å¿…ãšæ¸¬å®šæŒ‡æ¨™ï¼ˆç–¼ç—›ã€ROMã€ç­‹åŠ›ãªã©ï¼‰ã‚’è¨˜éŒ²ã—ã€åŠ¹æœåˆ¤å®šã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹', priority: 'high' },
                        { task: 'æ²»ç™‚è¨ˆç”»ã‚’ç«‹ã¦ã‚‹éš›ã€å¿…ãšã€ŒçŸ­æœŸç›®æ¨™ï¼ˆ1-2é€±é–“ï¼‰ã€ã¨ã€Œæ¸¬å®šæ–¹æ³•ã€ã‚’æ˜è¨˜ã™ã‚‹', priority: 'medium' }
                    ],
                    2: [
                        { task: 'å„ªå…ˆé †ä½ã®é«˜ã„å•é¡Œã‹ã‚‰é †ã«æ²»ç™‚ã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹ï¼ˆç·Šæ€¥åº¦ãƒ»é‡è¦åº¦ã‚’æ¯å›ç¢ºèªï¼‰', priority: 'high' },
                        { task: 'æ²»ç™‚åŠ¹æœã‚’å®šé‡çš„ã«æ¸¬å®šã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ï¼ˆVASã€ROMã€ç­‹åŠ›ã€æ­©è¡Œé€Ÿåº¦ãªã©ï¼‰', priority: 'medium' },
                        { task: 'è¨ˆç”»ã—ãŸæ²»ç™‚ãŒåŠ¹æœã‚’ç¤ºã•ãªã„å ´åˆã®ã€Œãƒ—ãƒ©ãƒ³Bã€ã‚’äº‹å‰ã«è€ƒãˆã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹', priority: 'medium' }
                    ]
                }
            },
            {
                id: 'communicating',
                title: 'Communicatingï¼ˆã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰',
                subtitle: 'æ‚£è€…ä¸­å¿ƒã®ã‚±ã‚¢ - ãƒãƒ¼ãƒ é€£æºã¨èª¬æ˜èƒ½åŠ›',
                criteria: [
                    { score: 1, text: 'ä»–è·ç¨®ï¼ˆåŒ»å¸«ãƒ»çœ‹è­·å¸«ãªã©ï¼‰ã¨ã®é€£æºãŒã§ããšã€æ‚£è€…ã¸ã®èª¬æ˜ã‚‚ä¸ååˆ†ã€‚æ‚£è€…ã®å¸Œæœ›ã‚’èã‘ã¦ã„ãªã„ã€‚' },
                    { score: 2, text: 'ä»–è·ç¨®ã¨ã®é€£æºã‚„æ‚£è€…ã¸ã®èª¬æ˜ãŒä¸å®Œå…¨ã€‚æ‚£è€…ã®å¸Œæœ›ã‚’èããŒã€æ²»ç™‚è¨ˆç”»ã«åæ˜ ã—ãã‚Œã¦ã„ãªã„ã€‚' },
                    { score: 3, text: 'ä»–è·ç¨®ã¨åŠ¹æœçš„ã«é€£æºã—ã€æ‚£è€…ã«ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã§ãã‚‹ã€‚æ‚£è€…ãƒ»å®¶æ—ã®å¸Œæœ›ã‚’æ²»ç™‚ã«åæ˜ ã§ãã‚‹ã€‚' }
                ],
                improvementTasks: {
                    1: [
                        { task: 'SBARãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã‚±ãƒ¼ã‚¹ãƒ—ãƒ¬ã‚¼ãƒ³ã®ç·´ç¿’ã‚’ã™ã‚‹ï¼ˆSituation, Background, Assessment, Recommendationï¼‰', priority: 'high' },
                        { task: 'æ‚£è€…ã¸ã®èª¬æ˜æ™‚ã«ã€Œteach-backæ³•ã€ã‚’ä½¿ã†ï¼šæ‚£è€…ã«èª¬æ˜å†…å®¹ã‚’è‡ªåˆ†ã®è¨€è‘‰ã§è¨€ã„ç›´ã—ã¦ã‚‚ã‚‰ã†', priority: 'high' },
                        { task: 'å¤šè·ç¨®ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã«ç©æ¥µçš„ã«å‚åŠ ã—ã€é€£æºã®æ–¹æ³•ã‚’å­¦ã¶', priority: 'high' },
                        { task: 'æ‚£è€…ã®ã€Œå¸Œæœ›ãƒ»ç›®æ¨™ã€ã‚’æ¯å›ç¢ºèªã—ã€ã‚«ãƒ«ãƒ†ã«è¨˜éŒ²ã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹', priority: 'medium' }
                    ],
                    2: [
                        { task: 'ã‚³ãƒ³ã‚µãƒ«ãƒˆæ™‚ã«ã€Œå•é¡Œè¡¨ç¾ï¼‹é‘‘åˆ¥ï¼‹ã“ã¡ã‚‰ã®æ‡¸å¿µã€ã‚’ç°¡æ½”ã«ä¼ãˆã‚‹ç·´ç¿’ã‚’ã™ã‚‹', priority: 'high' },
                        { task: 'æ‚£è€…ãƒ»å®¶æ—ã¸ã®èª¬æ˜ã‚’å…ˆè¼©ã«è¦³å¯Ÿã—ã¦ã‚‚ã‚‰ã„ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚‚ã‚‰ã†', priority: 'medium' },
                        { task: 'å…±æœ‰æ„æ€æ±ºå®šï¼ˆSDMï¼‰ã®æ–¹æ³•ã‚’å­¦ã³ã€æ²»ç™‚é¸æŠè‚¢ã‚’è¤‡æ•°æç¤ºã™ã‚‹ç·´ç¿’ã‚’ã™ã‚‹', priority: 'medium' }
                    ]
                }
            },
            {
                id: 'reflecting',
                title: 'Reflectingï¼ˆçœå¯Ÿï¼‰',
                subtitle: 'ãƒ¡ã‚¿èªçŸ¥ - è‡ªåˆ†ã®åˆ¤æ–­ã‚’æŒ¯ã‚Šè¿”ã‚Œã‚‹ã‹',
                criteria: [
                    { score: 1, text: 'è‡ªåˆ†ã®è©•ä¾¡ãƒ»æ²»ç™‚ã®åˆ¤æ–­ã‚’æŒ¯ã‚Šè¿”ã‚‹ã“ã¨ãŒã§ããªã„ã€‚ã€Œãªãœã†ã¾ãã„ã‹ãªã‹ã£ãŸã‹ã€ã‚’è€ƒãˆã‚‰ã‚Œãªã„ã€‚' },
                    { score: 2, text: 'ã‚ã‚‹ç¨‹åº¦æŒ¯ã‚Šè¿”ã‚Œã‚‹ãŒã€ã€Œæ¬¡ã«ã©ã†æ”¹å–„ã™ã‚‹ã‹ã€ã¾ã§è€ƒãˆã‚‰ã‚Œãªã„ã€‚åŒã˜å¤±æ•—ã‚’ç¹°ã‚Šè¿”ã—ãŒã¡ã€‚' },
                    { score: 3, text: 'è‡ªåˆ†ã®åˆ¤æ–­ã‚’å®¢è¦³çš„ã«æŒ¯ã‚Šè¿”ã‚Šã€ã€Œãªãœãã†åˆ¤æ–­ã—ãŸã‹ã€ã€Œæ¬¡ã¯ã©ã†ã™ã‚‹ã‹ã€ã‚’æ˜ç¢ºã«ã§ãã‚‹ã€‚' }
                ],
                improvementTasks: {
                    1: [
                        { task: 'ç—‡ä¾‹ã”ã¨ã«ã€ŒæŒ¯ã‚Šè¿”ã‚Šã‚·ãƒ¼ãƒˆã€ã‚’ä½œæˆã™ã‚‹ï¼šâ‘ ã†ã¾ãã„ã£ãŸç‚¹ â‘¡æ”¹å–„ç‚¹ â‘¢æ¬¡å›ã®è¡Œå‹•è¨ˆç”»', priority: 'high' },
                        { task: 'æ¯æ—¥ã®è¨ºç™‚çµ‚äº†å¾Œã«5åˆ†é–“ã€ã€Œä»Šæ—¥ã®3ã¤ã®å­¦ã³ã€ã‚’ãƒ¡ãƒ¢ã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹', priority: 'high' },
                        { task: 'ã‚¢ãƒ³ã‚«ãƒªãƒ³ã‚°ï¼ˆæ€ã„è¾¼ã¿ï¼‰ã‚„æ—©æœŸé–‰é–ï¼ˆæ€§æ€¥ãªåˆ¤æ–­ï¼‰ãŒãªã‹ã£ãŸã‹ã€æ¯é€±ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã™ã‚‹', priority: 'medium' },
                        { task: 'å…ˆè¼©ã«ã€Œè‡ªåˆ†ã®åˆ¤æ–­ãƒ—ãƒ­ã‚»ã‚¹ã€ã‚’èª¬æ˜ã—ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚‚ã‚‰ã†æ©Ÿä¼šã‚’ä½œã‚‹', priority: 'medium' }
                    ],
                    2: [
                        { task: 'å¤±æ•—ã‚±ãƒ¼ã‚¹ã‚’åˆ†æã—ã€ã€Œãªãœãã†åˆ¤æ–­ã—ãŸã‹ã€ã€Œãƒã‚¤ã‚¢ã‚¹ã¯ãªã‹ã£ãŸã‹ã€ã‚’æŒ¯ã‚Šè¿”ã‚‹', priority: 'high' },
                        { task: 'ã€Œæ¬¡ã«åŒã˜ã‚±ãƒ¼ã‚¹ãŒæ¥ãŸã‚‰ä½•ã‚’å¤‰ãˆã‚‹ã‹ã€ã‚’å…·ä½“çš„ã«è¨€èªåŒ–ã™ã‚‹ç·´ç¿’ã‚’ã™ã‚‹', priority: 'high' },
                        { task: 'æœˆ1å›ã€è‡ªåˆ†ã®ç—‡ä¾‹ã‚’æŒ¯ã‚Šè¿”ã‚Šã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„å‚¾å‘ã‚’åˆ†æã™ã‚‹æ™‚é–“ã‚’ä½œã‚‹', priority: 'medium' }
                    ]
                }
            }
        ];

        let beforeScores = {};
        let afterScores = {};
        let beforeChart = null;
        let afterChart = null;
        let comparisonChart = null;

        // åˆæœŸåŒ–
        function init() {
            createAssessment('before');
            createAssessment('after');
            loadSavedScores();
            updateAllCharts();
            updateImprovementTasks('before');
            updateImprovementTasks('after');
        }

        // è©•ä¾¡ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ
        function createAssessment(type) {
            const container = document.getElementById(`${type}-assessment`);
            container.innerHTML = '';

            domains.forEach(domain => {
                const section = document.createElement('div');
                section.className = 'domain-section';
                section.innerHTML = `
                    <div class="domain-header">
                        <div>
                            <span class="domain-title">${domain.title}</span>
                            <span class="domain-subtitle">${domain.subtitle}</span>
                        </div>
                        <div class="score-display" id="${type}-${domain.id}-score">æœªé¸æŠ</div>
                    </div>
                    <div class="criteria-grid" id="${type}-${domain.id}-grid"></div>
                `;
                container.appendChild(section);

                const grid = document.getElementById(`${type}-${domain.id}-grid`);
                domain.criteria.forEach(criteria => {
                    const card = document.createElement('div');
                    card.className = 'criteria-card';
                    card.innerHTML = `
                        <div class="criteria-score">${criteria.score}ç‚¹</div>
                        <div class="criteria-text">${criteria.text}</div>
                    `;
                    card.onclick = () => selectCriteria(type, domain.id, criteria.score);
                    grid.appendChild(card);
                });
            });
        }

        // åŸºæº–ã®é¸æŠ
        function selectCriteria(type, domainId, score) {
            const scores = type === 'before' ? beforeScores : afterScores;
            scores[domainId] = score;

            // é¸æŠçŠ¶æ…‹ã®æ›´æ–°
            const grid = document.getElementById(`${type}-${domainId}-grid`);
            const cards = grid.querySelectorAll('.criteria-card');
            cards.forEach((card, index) => {
                card.classList.toggle('selected', index + 1 === score);
            });

            // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã®æ›´æ–°
            document.getElementById(`${type}-${domainId}-score`).textContent = `${score}ç‚¹`;

            // åˆè¨ˆã‚¹ã‚³ã‚¢ã®æ›´æ–°
            updateTotalScore(type);
            updateChart(type);
        }

        // åˆè¨ˆã‚¹ã‚³ã‚¢ã®æ›´æ–°
        function updateTotalScore(type) {
            const scores = type === 'before' ? beforeScores : afterScores;
            const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
            document.getElementById(`${type}-total`).textContent = `${total} / 15`;

            // ãƒ¬ãƒ™ãƒ«åˆ¤å®šã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
            updateScoreLevel(type, total);

            // æ”¹å–„ã‚¿ã‚¹ã‚¯ã®è¡¨ç¤º
            updateImprovementTasks(type);
        }

        // ã‚¹ã‚³ã‚¢ãƒ¬ãƒ™ãƒ«ã®åˆ¤å®šã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
        function updateScoreLevel(type, total) {
            const badgeElement = document.getElementById(`${type}-level-badge`);
            const feedbackElement = document.getElementById(`${type}-feedback`);

            if (total === 0) {
                badgeElement.innerHTML = '';
                feedbackElement.innerHTML = '';
                return;
            }

            let badgeHTML = '';
            let feedbackHTML = '';

            if (total <= 12) {
                // è¦æ”¹å–„ãƒ¬ãƒ™ãƒ«ï¼ˆ12ç‚¹ä»¥ä¸‹ï¼‰
                badgeHTML = '<div class="score-level-badge needs-improvement">âš ï¸ è¦æ”¹å–„ãƒ¬ãƒ™ãƒ«</div>';

                if (total <= 7) {
                    feedbackHTML = `
                        <strong>ç¾çŠ¶ï¼š</strong>è‡¨åºŠæ¨è«–ã®åŸºæœ¬çš„ãªæ§‹é€ ãŒèº«ã«ã¤ã„ã¦ã„ãªã„çŠ¶æ…‹ã§ã™ã€‚<br>
                        <strong>èª²é¡Œï¼š</strong>è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã®åé›†ã¯ã§ãã¦ã‚‚ã€è§£é‡ˆã‚„åˆ¤æ–­ãŒå¼±ãã€è¨€èªåŒ–ãŒé›£ã—ã„çŠ¶æ³ã§ã™ã€‚<br>
                        <strong>ç›®æ¨™ï¼š</strong>Think Clarityãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§13ç‚¹ä»¥ä¸Šï¼ˆè¬›åº§ç›®æ¨™ãƒ¬ãƒ™ãƒ«ï¼‰ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚
                    `;
                } else if (total <= 9) {
                    feedbackHTML = `
                        <strong>ç¾çŠ¶ï¼š</strong>åŸºæœ¬çš„ãªè‡¨åºŠæ¨è«–ã¯ã§ãã¾ã™ãŒã€èª¬æ˜ãŒä¸ååˆ†ã§ã™ã€‚<br>
                        <strong>èª²é¡Œï¼š</strong>ã€Œãªãœãã®åˆ¤æ–­ã‚’ã—ãŸã‹ã€ã‚’è¨€èªåŒ–ã§ããªã„çŠ¶æ…‹ã§ã™ï¼ˆçµŒé¨“å¹´æ•°3-5å¹´ç›®ã®å¹³å‡çš„ãªãƒ¬ãƒ™ãƒ«ï¼‰ã€‚<br>
                        <strong>ç›®æ¨™ï¼š</strong>Think Clarityãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§13ç‚¹ä»¥ä¸Šï¼ˆè¬›åº§ç›®æ¨™ãƒ¬ãƒ™ãƒ«ï¼‰ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚
                    `;
                } else {
                    feedbackHTML = `
                        <strong>ç¾çŠ¶ï¼š</strong>è‡¨åºŠæ¨è«–ã®åŸºæœ¬æ§‹é€ ã¯èº«ã«ã¤ã„ã¦ã„ã¾ã™ãŒã€ã¾ã æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚<br>
                        <strong>ç›®æ¨™ï¼š</strong>ã‚ã¨å°‘ã—ã§è¬›åº§ç›®æ¨™ãƒ¬ãƒ™ãƒ«ï¼ˆ13ç‚¹ä»¥ä¸Šï¼‰ã§ã™ã€‚Think Clarityãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§æœ€å¾Œã®ä¸€æŠ¼ã—ã‚’ï¼
                    `;
                }
            } else {
                // è¬›åº§ç›®æ¨™ãƒ¬ãƒ™ãƒ«é”æˆï¼ˆ13ç‚¹ä»¥ä¸Šï¼‰
                badgeHTML = '<div class="score-level-badge goal-achieved">âœ… è¬›åº§ç›®æ¨™ãƒ¬ãƒ™ãƒ«é”æˆ</div>';

                if (total <= 13) {
                    feedbackHTML = `
                        <strong>ç´ æ™´ã‚‰ã—ã„ï¼</strong>é«˜åº¦ãªè‡¨åºŠæ¨è«–èƒ½åŠ›ã‚’æŒã£ã¦ã„ã¾ã™ã€‚<br>
                        è¤‡é›‘ãªç—‡ä¾‹ã§ã‚‚è«–ç†çš„ã«èª¬æ˜ã§ãã€æ‚£è€…ã¸ã®èª¬æ˜ã‚„å¾Œè¼©æŒ‡å°ã‚‚ååˆ†ã«ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã§ã™ã€‚<br>
                        ã•ã‚‰ãªã‚‹é«˜ã¿ã‚’ç›®æŒ‡ã™ãªã‚‰ã€ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ï¼ˆ14-15ç‚¹ï¼‰ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚
                    `;
                } else {
                    feedbackHTML = `
                        <strong>ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ï¼</strong>è‡¨åºŠæ¨è«–ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã§ã™ã€‚<br>
                        æŒ‡å°è€…ãƒ»æ•™è‚²è€…ã¨ã—ã¦æ´»èºã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã«é”ã—ã¦ã„ã¾ã™ã€‚<br>
                        ã“ã®èƒ½åŠ›ã‚’ç¶­æŒã—ãªãŒã‚‰ã€å¾Œè¼©ã®è‚²æˆã«ã‚‚åŠ›ã‚’æ³¨ã„ã§ãã ã•ã„ã€‚
                    `;
                }
            }

            badgeElement.innerHTML = badgeHTML;
            feedbackElement.innerHTML = feedbackHTML;
        }

        // ãƒãƒ£ãƒ¼ãƒˆã®æ›´æ–°
        function updateChart(type) {
            const scores = type === 'before' ? beforeScores : afterScores;
            const data = domains.map(d => scores[d.id] || 0);
            const labels = domains.map(d => d.title.split('ï¼ˆ')[0]);

            const canvas = document.getElementById(`${type}-chart`);
            const ctx = canvas.getContext('2d');

            if (type === 'before' && beforeChart) {
                beforeChart.destroy();
            } else if (type === 'after' && afterChart) {
                afterChart.destroy();
            }

            const chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: type === 'before' ? 'Beforeè©•ä¾¡' : 'Afterè©•ä¾¡',
                            data: data,
                            backgroundColor: type === 'before' ? 'rgba(100, 181, 246, 0.2)' : 'rgba(129, 199, 132, 0.2)',
                            borderColor: type === 'before' ? 'rgba(100, 181, 246, 1)' : 'rgba(129, 199, 132, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: type === 'before' ? 'rgba(100, 181, 246, 1)' : 'rgba(129, 199, 132, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: type === 'before' ? 'rgba(100, 181, 246, 1)' : 'rgba(129, 199, 132, 1)'
                        },
                        {
                            label: 'è¬›åº§ç›®æ¨™ãƒ¬ãƒ™ãƒ« (13ç‚¹)',
                            data: [2.6, 2.6, 2.6, 2.6, 2.6],
                            backgroundColor: 'rgba(255, 152, 0, 0.05)',
                            borderColor: 'rgba(255, 152, 0, 0.8)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            pointHoverRadius: 0
                        }
                    ]
                },
                options: {
                    scales: {
                        r: {
                            min: 0,
                            max: 3,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });

            if (type === 'before') {
                beforeChart = chart;
            } else {
                afterChart = chart;
            }
        }

        // æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆã®æ›´æ–°
        function updateComparisonChart() {
            const beforeData = domains.map(d => beforeScores[d.id] || 0);
            const afterData = domains.map(d => afterScores[d.id] || 0);
            const labels = domains.map(d => d.title.split('ï¼ˆ')[0]);

            const canvas = document.getElementById('comparison-chart');
            const ctx = canvas.getContext('2d');

            if (comparisonChart) {
                comparisonChart.destroy();
            }

            comparisonChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Beforeè©•ä¾¡',
                            data: beforeData,
                            backgroundColor: 'rgba(100, 181, 246, 0.2)',
                            borderColor: 'rgba(100, 181, 246, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(100, 181, 246, 1)'
                        },
                        {
                            label: 'Afterè©•ä¾¡',
                            data: afterData,
                            backgroundColor: 'rgba(129, 199, 132, 0.2)',
                            borderColor: 'rgba(129, 199, 132, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(129, 199, 132, 1)'
                        },
                        {
                            label: 'è¬›åº§ç›®æ¨™ãƒ¬ãƒ™ãƒ« (13ç‚¹)',
                            data: [2.6, 2.6, 2.6, 2.6, 2.6],
                            backgroundColor: 'rgba(255, 152, 0, 0.05)',
                            borderColor: 'rgba(255, 152, 0, 0.8)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            pointHoverRadius: 0
                        }
                    ]
                },
                options: {
                    scales: {
                        r: {
                            min: 0,
                            max: 3,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // æ¯”è¼ƒçµæœã®æ›´æ–°
        function updateComparison() {
            const comparisonDiv = document.getElementById('score-comparison');
            const summaryDiv = document.getElementById('growth-summary');

            let comparisonHTML = '';
            let improvements = 0;
            let totalChange = 0;

            domains.forEach(domain => {
                const before = beforeScores[domain.id] || 0;
                const after = afterScores[domain.id] || 0;
                const change = after - before;
                totalChange += change;

                if (change > 0) improvements++;

                const changeClass = change > 0 ? 'positive' : (change < 0 ? 'negative' : '');
                const changeText = change > 0 ? `+${change}` : change;

                comparisonHTML += `
                    <div class="score-item">
                        <span>${domain.title.split('ï¼ˆ')[0]}</span>
                        <span>${before}ç‚¹ â†’ ${after}ç‚¹ <span class="score-change ${changeClass}">(${changeText})</span></span>
                    </div>
                `;
            });

            comparisonDiv.innerHTML = comparisonHTML;

            const beforeTotal = Object.values(beforeScores).reduce((sum, s) => sum + s, 0);
            const afterTotal = Object.values(afterScores).reduce((sum, s) => sum + s, 0);
            const totalChangeValue = afterTotal - beforeTotal;
            const totalChangeClass = totalChangeValue > 0 ? 'positive' : (totalChangeValue < 0 ? 'negative' : '');

            summaryDiv.innerHTML = `
                <div class="score-item">
                    <span>åˆè¨ˆã‚¹ã‚³ã‚¢</span>
                    <span>${beforeTotal}ç‚¹ â†’ ${afterTotal}ç‚¹ <span class="score-change ${totalChangeClass}">(${totalChangeValue > 0 ? '+' : ''}${totalChangeValue})</span></span>
                </div>
                <div class="score-item">
                    <span>æ”¹å–„ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³æ•°</span>
                    <span>${improvements} / 5</span>
                </div>
                <div class="score-item">
                    <span>å¹³å‡ã‚¹ã‚³ã‚¢</span>
                    <span>${(beforeTotal / 5).toFixed(1)}ç‚¹ â†’ ${(afterTotal / 5).toFixed(1)}ç‚¹</span>
                </div>
            `;

            updateComparisonChart();
        }

        // ã™ã¹ã¦ã®ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°
        function updateAllCharts() {
            updateChart('before');
            updateChart('after');
            updateComparison();
        }

        // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');

            if (tabName === 'comparison') {
                updateComparison();
            }
        }

        // Beforeè©•ä¾¡ã‚’ä¿å­˜
        function saveBeforeScore() {
            if (Object.keys(beforeScores).length < 5) {
                alert('ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            localStorage.setItem('reactBeforeScores', JSON.stringify(beforeScores));
            alert('Beforeè©•ä¾¡ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        // Afterè©•ä¾¡ã‚’ä¿å­˜
        function saveAfterScore() {
            if (Object.keys(afterScores).length < 5) {
                alert('ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            localStorage.setItem('reactAfterScores', JSON.stringify(afterScores));
            alert('Afterè©•ä¾¡ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        // ä¿å­˜ã•ã‚ŒãŸè©•ä¾¡ã‚’èª­ã¿è¾¼ã¿
        function loadSavedScores() {
            const savedBefore = localStorage.getItem('reactBeforeScores');
            const savedAfter = localStorage.getItem('reactAfterScores');

            if (savedBefore) {
                beforeScores = JSON.parse(savedBefore);
                Object.entries(beforeScores).forEach(([domainId, score]) => {
                    selectCriteria('before', domainId, score);
                });
            }

            if (savedAfter) {
                afterScores = JSON.parse(savedAfter);
                Object.entries(afterScores).forEach(([domainId, score]) => {
                    selectCriteria('after', domainId, score);
                });
            }
        }

        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆBeforeï¼‰
        function exportBeforeCSV() {
            if (Object.keys(beforeScores).length < 5) {
                alert('ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            exportCSV(beforeScores, 'REACT_Beforeè©•ä¾¡');
        }

        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆAfterï¼‰
        function exportAfterCSV() {
            if (Object.keys(afterScores).length < 5) {
                alert('ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            exportCSV(afterScores, 'REACT_Afterè©•ä¾¡');
        }

        // CSVå‡ºåŠ›
        function exportCSV(scores, filename) {
            const total = Object.values(scores).reduce((sum, s) => sum + s, 0);
            let csv = 'ãƒ‰ãƒ¡ã‚¤ãƒ³,ã‚¹ã‚³ã‚¢\n';
            domains.forEach(domain => {
                csv += `${domain.title},${scores[domain.id] || 0}\n`;
            });
            csv += `åˆè¨ˆ,${total}\n`;

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // æ”¹å–„ã‚¿ã‚¹ã‚¯ã®è¡¨ç¤º
        function updateImprovementTasks(type) {
            const scores = type === 'before' ? beforeScores : afterScores;
            const sectionElement = document.getElementById(`${type}-improvement-section`);

            // ã‚¹ã‚³ã‚¢ãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„å ´åˆã¯éè¡¨ç¤º
            if (Object.keys(scores).length === 0) {
                sectionElement.innerHTML = '';
                return;
            }

            // 3ç‚¹æº€ç‚¹ã§ãªã„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åé›†
            const improvementNeeded = domains.filter(domain => {
                const score = scores[domain.id];
                return score && score < 3;
            });

            // ã™ã¹ã¦3ç‚¹ã®å ´åˆ
            if (improvementNeeded.length === 0) {
                sectionElement.innerHTML = `
                    <div class="improvement-section">
                        <div class="no-improvements">
                            <div class="emoji">ğŸ‰</div>
                            <div><strong>ç´ æ™´ã‚‰ã—ã„ï¼</strong></div>
                            <div>ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã§æº€ç‚¹ã‚’é”æˆã—ã¦ã„ã¾ã™ã€‚ã“ã®é«˜ã„ãƒ¬ãƒ™ãƒ«ã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ï¼</div>
                        </div>
                    </div>
                `;
                return;
            }

            // æ”¹å–„ã‚¿ã‚¹ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ§‹ç¯‰
            let html = `
                <div class="improvement-section">
                    <div class="improvement-header">
                        <span style="font-size: 1.8em;">ğŸ’¡</span>
                        <h3>ã‚ãªãŸã®æˆé•·ãƒ—ãƒ©ãƒ³</h3>
                    </div>
                    <div class="improvement-intro">
                        <p><strong>ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã§å¼±ç‚¹ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚</strong>ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã«å–ã‚Šçµ„ã‚€ã“ã¨ã§ã€è‡¨åºŠæ¨è«–ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
                        <p style="margin-top: 10px; color: #666;">å„ªå…ˆåº¦ã®é«˜ã„ã‚¿ã‚¹ã‚¯ã‹ã‚‰é †ã«å–ã‚Šçµ„ã¿ã¾ã—ã‚‡ã†ã€‚ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é€²æ—ã‚’è¨˜éŒ²ã§ãã¾ã™ã€‚</p>
                    </div>
            `;

            improvementNeeded.forEach(domain => {
                const score = scores[domain.id];
                const tasks = domain.improvementTasks[score] || [];
                const priorityLabel = score === 1 ? 'å„ªå…ˆåº¦ï¼šç·Šæ€¥' : 'å„ªå…ˆåº¦ï¼šé«˜';

                html += `
                    <div class="domain-improvement">
                        <div class="domain-improvement-header">
                            <div class="domain-improvement-title">${domain.title}</div>
                            <div class="current-score-badge">ç¾åœ¨ ${score}/3ç‚¹ - ${priorityLabel}</div>
                        </div>
                        <ul class="task-list">
                `;

                tasks.forEach((taskItem, index) => {
                    const priorityText = taskItem.priority === 'high' ? 'å„ªå…ˆåº¦ï¼šé«˜' : 'å„ªå…ˆåº¦ï¼šä¸­';
                    html += `
                        <li class="task-item">
                            <div class="task-checkbox" onclick="toggleTaskCheck(this)"></div>
                            <div class="task-content">
                                <div class="task-text">${taskItem.task}</div>
                                <span class="task-priority ${taskItem.priority}">${priorityText}</span>
                            </div>
                        </li>
                    `;
                });

                html += `
                        </ul>
                    </div>
                `;
            });

            html += '</div>';
            sectionElement.innerHTML = html;
        }

        // ã‚¿ã‚¹ã‚¯ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ãƒˆã‚°ãƒ«
        function toggleTaskCheck(checkbox) {
            if (checkbox.innerHTML === 'âœ“') {
                checkbox.innerHTML = '';
                checkbox.style.background = '';
            } else {
                checkbox.innerHTML = 'âœ“';
                checkbox.style.background = '#64b5f6';
                checkbox.style.color = 'white';
                checkbox.style.display = 'flex';
                checkbox.style.alignItems = 'center';
                checkbox.style.justifyContent = 'center';
                checkbox.style.fontSize = '14px';
                checkbox.style.fontWeight = 'bold';
            }
        }

        // æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
        function exportComparisonReport() {
            if (Object.keys(beforeScores).length < 5 || Object.keys(afterScores).length < 5) {
                alert('Beforeã¨Afterä¸¡æ–¹ã®è©•ä¾¡ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const beforeTotal = Object.values(beforeScores).reduce((sum, s) => sum + s, 0);
            const afterTotal = Object.values(afterScores).reduce((sum, s) => sum + s, 0);
            const totalChange = afterTotal - beforeTotal;

            let markdown = `# REACT è‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«è©•ä¾¡ æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆ\n\n`;
            markdown += `**è©•ä¾¡æ—¥**: ${new Date().toLocaleDateString('ja-JP')}\n\n`;
            markdown += `---\n\n`;
            markdown += `## ğŸ“Š ç·åˆã‚¹ã‚³ã‚¢\n\n`;
            markdown += `- **Before**: ${beforeTotal} / 15ç‚¹\n`;
            markdown += `- **After**: ${afterTotal} / 15ç‚¹\n`;
            markdown += `- **å¤‰åŒ–**: ${totalChange > 0 ? '+' : ''}${totalChange}ç‚¹\n\n`;
            markdown += `---\n\n`;
            markdown += `## ğŸ“ˆ ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ã‚¹ã‚³ã‚¢\n\n`;
            markdown += `| ãƒ‰ãƒ¡ã‚¤ãƒ³ | Before | After | å¤‰åŒ– |\n`;
            markdown += `|---------|--------|-------|------|\n`;

            domains.forEach(domain => {
                const before = beforeScores[domain.id] || 0;
                const after = afterScores[domain.id] || 0;
                const change = after - before;
                markdown += `| ${domain.title} | ${before}ç‚¹ | ${after}ç‚¹ | ${change > 0 ? '+' : ''}${change}ç‚¹ |\n`;
            });

            markdown += `\n---\n\n`;
            markdown += `## ğŸ’¡ æˆé•·ã‚µãƒãƒªãƒ¼\n\n`;

            const improvements = domains.filter(d => (afterScores[d.id] || 0) > (beforeScores[d.id] || 0));
            if (improvements.length > 0) {
                markdown += `### æ”¹å–„ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ${improvements.length} / 5ï¼‰\n\n`;
                improvements.forEach(domain => {
                    const change = afterScores[domain.id] - beforeScores[domain.id];
                    markdown += `- **${domain.title}**: +${change}ç‚¹ã®å‘ä¸Š\n`;
                });
                markdown += `\n`;
            }

            const maintained = domains.filter(d => (afterScores[d.id] || 0) === (beforeScores[d.id] || 0));
            if (maintained.length > 0) {
                markdown += `### ç¶­æŒã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ${maintained.length} / 5ï¼‰\n\n`;
                maintained.forEach(domain => {
                    markdown += `- **${domain.title}**: ${beforeScores[domain.id]}ç‚¹ã‚’ç¶­æŒ\n`;
                });
                markdown += `\n`;
            }

            markdown += `---\n\n`;
            markdown += `**ğŸ¤– Generated by REACTè‡¨åºŠæ¨è«–ãƒ¬ãƒ™ãƒ«è©•ä¾¡ãƒ„ãƒ¼ãƒ«**\n`;

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `REACTæ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆ_${new Date().toISOString().split('T')[0]}.md`;
            link.click();

            alert('æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        init();
    </script>
</body>
</html>
